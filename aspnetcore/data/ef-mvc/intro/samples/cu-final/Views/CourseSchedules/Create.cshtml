@model ContosoUniversity.Models.CourseSchedule

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Create</h2>

<h4>CourseSchedule</h4>
<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <div class="form-group">
                <label asp-for="CourseID" class="control-label">课程</label>
                <select id="courseSelect" name="CourseID">
                    <option value="-1">请选择课程</option>
                </select>
                <span asp-validation-for="CourseID" class="text-danger"></span>

            </div>
            <div class="form-group">
                <label asp-for="InstructorID" class="control-label">老师</label>
                <select id="InstructorSelect" name="InstructorID" class="input-group-lg">
                    <option value="-1">请选择老师</option>
                </select>
                <span asp-validation-for="InstructorID" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="ScheduleDate" class="control-label"></label>
                <input type="text" value="2012-05-15 21:05" id="datetimepicker">
                <input name="ScheduleDate" type="date" class="form-control" min="@ViewData["starDate"]" max="@ViewData["endDate"]" />
            </div>
            <div class="form-group">
                <table class="table" id="studentTable">
                    <tr><td>是否请假</td><td>学生姓名</td></tr>
                    <td> <input type="checkbox" disabled /> </td>
                </table>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
<script src="~/lib/jquery/dist/jquery.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script>
    $(document).ready(function () {
        $('#datetimepicker').datetimepicker({
            format: 'yyyy-mm-dd'
        });
        $.ajax({
            url: "/CourseSchedules/GetCourseDropDownList",
            type: "POST",
            success: function (data) {
                var optionString = '';
                for (var i = 0; i < data.length; i++) {
                    optionString += '<option value="' + data[i].key + '">' + data[i].value + '</option>';
                }
                $("#courseSelect").append(optionString);
            }
        });


        var dealInstructorSelect = function (data) {
            if (data.allInstructor) {
                var optionString = '<option value=-1>请选择老师</option>';
                for (var i = 0; i < data.allInstructor.length; i++) {
                    optionString += '<option value="' + data.allInstructor[i].key + '">' + data.allInstructor[i].value + '</option>';
                }
                $("#InstructorSelect").empty();
                $("#InstructorSelect").append(optionString);
            }
        }

        var dealStudentTable = function (data) {
            if (data.allStudent) {
                var studentTh = "<tr><td>是否请假</td><td>学生姓名</td></tr>"
                for (i = 0; i < data.allStudent.length; i++) {
                    var studentStr = '<tr><td><input type="checkbox" name="leaveStrudentId" value="' + data.allStudent[i].key + '"/></td><td>' + data.allStudent[i].value + '</td></tr>'
                    studentTh += studentStr;
                }
                $("#studentTable").empty().append(studentTh);
            }
        }

        $("#courseSelect").bind('change', function () {
            var courseId = $("#courseSelect").val();
            if (courseId && courseId != -1) {
                $.ajax({
                    url: "/CourseSchedules/GetInstructorByCourseID",
                    type: "POST",
                    data: { "CourseID": courseId },
                    success: function (data) {
                        dealInstructorSelect(data);
                        dealStudentTable(data);
                    }
                });
            } else {
                var optionString = '<option value=-1>请选择老师</option>';
                $("#InstructorSelect").empty();
                $("#InstructorSelect").append(optionString);
                $("#studentTable").empty();
            }

        });
    });

</script>